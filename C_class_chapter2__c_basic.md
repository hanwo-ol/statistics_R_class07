### 분석의 목표: 데이터의 계층적 구조 파악하기

**계층적 군집분석(Hierarchical Clustering)**은 개별 데이터들을 점차 가까운 것끼리 묶어 나가면서 나무와 같은 계층 구조(dendrogram)를 만드는 분석 방법입니다. 이 방법의 가장 큰 특징은 **군집의 개수(k)를 미리 정할 필요가 없다**는 점입니다. 분석가는 생성된 덴드로그램을 보고 적절한 높이에서 잘라 원하는 개수의 군집을 얻을 수 있습니다.

이번 분석의 목표는 5개의 객체 간의 거리 정보를 바탕으로, 서로 다른 연결 방법(complete, single, average)을 사용하여 계층적 군집분석을 수행하고 그 결과를 덴드로그램으로 시각화하는 것입니다.

---

### 단계별 코드 및 결과 상세 해설

#### 1. 거리(Distance) 정보 준비

```R
> # 거리 벡터를 아래쪽 삼각형 순서대로 입력
> d <- c(
+   7,          # dist(2,1)
+   1, 6,       # dist(3,1), dist(3,2)
+   9, 3, 8,    # dist(4,1), dist(4,2), dist(4,3)
+   8, 5, 7, 4  # dist(5,1), dist(5,2), dist(5,3), dist(5,4)
+ )
> # dist 객체 생성
> dm <- as.dist(dm)               # 실제 거리 행렬
> dm
  1 2 3 4
2 7
3 1 6
4 9 3 8
5 8 5 7 4
```

##### **함수 기능 및 코드 흐름 설명**

*   `d <- c(...)`: 5개 객체 간의 모든 거리 쌍을 벡터 `d`에 저장합니다. R의 `dist` 객체는 메모리 효율을 위해 거리 행렬의 하삼각(lower triangle) 부분만 이 순서대로 저장합니다.
*   `dm`으로 변환하는 과정: R의 `hclust` 함수는 `dist` 클래스 객체를 입력으로 받기 때문에, 벡터 `d`를 공식적인 `dist` 객체로 변환하는 과정입니다.
    *   `dm <- matrix(0, nrow=5, ncol=5)`: 5x5 크기의 0으로 채워진 행렬을 만듭니다.
    *   `dm[upper.tri(dm)] <- d`: 행렬의 상삼각(upper triangle) 부분에 벡터 `d`의 값들을 채워 넣습니다.
    *   `dm <- dm + t(dm)`: 상삼각 행렬 `dm`과 그것의 전치행렬(하삼각 행렬)을 더하여 완전한 대칭 거리 행렬을 만듭니다.
    *   `as.dist(dm)`: 완전한 거리 행렬을 R이 인식하는 공식적인 `dist` 객체로 변환합니다.
*   **`dm` 출력 결과**: 5개 객체 간의 거리 정보를 담고 있는 최종 거리 행렬입니다. 예를 들어, 3번 객체와 1번 객체 간의 거리는 1이고, 4번 객체와 2번 객체 간의 거리는 3임을 알 수 있습니다. 이 거리 행렬이 계층적 군집분석의 기본 입력값이 됩니다.

---

#### 2. 계층적 군집분석 수행

```R
> # 계층적 군집분석
> hc1 <- hclust(dm, method = "complete")  # 또는 "average", "single" 등
> hc2 <- hclust(dm, method = "single")
> hc3 <- hclust(dm, method = "average")
> hc1 # hc2, hc3도 동일한 구조
```

##### **함수 기능 설명**

*   `hclust(d, method = ...)`: 계층적 군집분석을 수행하는 핵심 함수입니다.
    *   `d`: 거리 정보를 담고 있는 `dist` 객체입니다. (여기서는 `dm`)
    *   `method`: **군집 간의 거리를 측정하는 방법(연결법, Linkage)**을 지정하는 가장 중요한 인수입니다.
        *   `"complete"` (완전 연결법): 두 군집에 속한 모든 데이터 쌍의 거리 중 **가장 먼(최대) 거리**를 군집 간 거리로 정의합니다. 군집의 크기를 비슷하게 유지하는 경향이 있습니다.
        *   `"single"` (단일 연결법): 두 군집에 속한 모든 데이터 쌍의 거리 중 **가장 가까운(최소) 거리**를 군집 간 거리로 정의합니다. 사슬 모양의 길쭉한 군집을 만드는 경향이 있습니다.
        *   `"average"` (평균 연결법): 두 군집에 속한 모든 데이터 쌍의 거리의 **평균**을 군집 간 거리로 정의합니다. 완전 연결법과 단일 연결법의 절충안으로 널리 사용됩니다.
*   **`hc1` 출력 결과**:
    *   `Call`: 실행된 함수 호출 정보를 보여줍니다.
    *   `Cluster method`: 어떤 연결법을 사용했는지 알려줍니다. (여기서는 `complete`)
    *   `Number of objects`: 분석에 사용된 객체의 개수를 알려줍니다. (5개)
    *   이 객체(`hc1`, `hc2`, `hc3`) 안에는 덴드로그램을 그리는 데 필요한 모든 병합 순서와 높이 정보가 들어있습니다.

---

#### 3. 덴드로그램(Dendrogram) 시각화

##### **(1) 기본 `plot` 함수 사용**

<img width="2561" height="1494" alt="image" src="https://github.com/user-attachments/assets/bd22cd3c-373d-4fa6-96a9-ba85c8d38725" />


```R
> # 덴드로그램 그리기
> par(mfrow=c(1,3))
> plot(hc1, main = "complete")
> plot(hc2, main = "single")
> plot(hc3, main = "average")
```
##### **함수 기능 설명**
*   `par(mfrow=c(1,3))`: 그래픽 창을 1행 3열로 분할하여 3개의 그래프를 나란히 그릴 수 있도록 설정합니다.
*   `plot(hc1, ...)`: `hclust`로 생성된 객체를 `plot` 함수에 전달하면 자동으로 덴드로그램을 그려줍니다.
    *   `hc1`: 덴드로그램을 그릴 데이터(hclust 객체)입니다.
    *   `main = "..."`: 그래프의 제목을 설정합니다.

##### **(2) `factoextra` 패키지를 이용한 고급 시각화**

```R
> # 예쁜 그림
> f1 = factoextra::fviz_dend(hc1,
+           k = 3,                    # 군집 수 시각화
+           rect = TRUE,              # 군집 경계선 그리기
+           cex = 1.2,                # 라벨 크기
+           lwd = 1,                  # 선 굵기
+           main = "Complete Linkage Dendrogram")
```
##### **함수 기능 설명**
*   `factoextra::fviz_dend()`: `factoextra` 패키지에서 제공하는 덴드로그램 시각화 함수로, 기본 `plot` 함수보다 더 미려하고 정보가 풍부한 그래프를 쉽게 그릴 수 있습니다.
    *   `hc1`: `hclust` 객체.
    *   `k = 3`: 덴드로그램을 3개의 군집으로 자를 경우를 가정하여 각 군집의 가지를 다른 색으로 칠해줍니다.
    *   `rect = TRUE`: `k`개로 나뉜 군집들을 시각적으로 구분하기 위해 사각형 경계선을 그려줍니다.
    *   `cex`: 맨 아래 객체 번호(1, 2, 3, 4, 5)의 글자 크기를 조절합니다.
    *   `lwd`: 덴드로그램 가지의 선 굵기를 조절합니다.
    *   `main`: 그래프의 제목을 설정합니다.

##### **(3) `patchwork` 패키지를 이용한 그래프 조합**

<img width="2561" height="1494" alt="image" src="https://github.com/user-attachments/assets/511d2b28-4e2f-43b1-ac15-eb680e2f418b" />

```R
> (f1 + f2 + f3) +
+   patchwork:: plot_annotation(title = "Dendrograms by Linkage",
+                                theme = theme(plot.title = element_text(size = 16, face = "bold", hjust = 0.5)))
```

##### **함수 기능 설명**
*   `patchwork` 패키지는 `ggplot2` 기반의 그래프 객체(`f1`, `f2`, `f3` 등)를 `+`, `/`, `|` 와 같은 직관적인 연산자로 쉽게 조합하고 배열할 수 있게 해주는 매우 유용한 패키지입니다.
*   `(f1 + f2 + f3)`: `factoextra`로 생성한 3개의 덴드로그램 그래프 객체를 가로로 나란히 배열합니다.
*   `plot_annotation(...)`: 조합된 전체 그래프에 대한 공통 제목이나 주석을 추가합니다.
    *   `title = "..."`: 전체 그래프의 제목을 설정합니다.
    *   `theme = theme(...)`: 제목의 글자 크기, 굵기, 위치 등 세부적인 디자인 요소를 조정합니다.
