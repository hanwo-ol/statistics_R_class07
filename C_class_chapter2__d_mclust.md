이번 예제는 **모형-기반 군집분석(Model-based Clustering)**의 대표적인 방법인 **혼합 정규분포 모형(Gaussian Mixture Model)**을 다루고 있습니다. `mclust` 패키지를 사용하여 분석을 수행하며, 각 함수의 기능, 입력된 파라미터의 역할, 그리고 결과가 의미하는 바를 아주 상세하게 설명해 드리겠습니다.

### 분석의 목표: 데이터의 숨겨진 확률 분포 찾기

k-평균이나 계층적 군집분석이 '거리'를 기반으로 데이터를 나눈다면, **모형-기반 군집분석**은 데이터가 **여러 개의 확률 분포(예: 정규분포)가 섞여서 생성되었다고 가정**하고, 각 데이터가 어떤 분포에서 나왔을 확률이 높은지를 계산하여 군집을 나눕니다.

이번 분석의 목표는 다음과 같습니다.
1.  서로 다른 두 개의 정규분포를 섞어서 만든 모의실험 데이터를 생성합니다.
2.  `mclust` 패키지를 이용해 이 데이터에 숨겨진 원래의 두 분포(모수: 평균, 분산, 혼합 비율)를 얼마나 잘 찾아내는지 확인합니다.
3.  분산에 대한 제약 조건(등분산 vs. 이분산)을 다르게 설정했을 때 결과가 어떻게 달라지는지 비교합니다.

---

### 단계별 코드 및 결과 상세 해설

#### 1. 모의실험 데이터 생성 및 시각화

```R
> set.seed(1)       # 랜덤 시드 고정
> n = 100           # 샘플 수
> p = 0.4           # 혼합 비율
> u = rbinom(n, 1, p)             # 군집 인덱스 (0 또는 1)
> x1 = rnorm(n, 10, 1)            # cluster 1: 평균 10, 표준편차 1
> x2 = rnorm(n, 17, 1.5)          # cluster 2: 평균 17, 표준편차 1.5
> x = u * x1 + (1 - u) * x2       # 두 군집 섞은 데이터 생성
> plot(density(x))
```

##### **함수 기능 및 코드 흐름 설명**

*   `p = 0.4`: 첫 번째 군집(`x1`)이 전체 데이터에서 차지할 비율을 40%로 설정합니다.
*   `u = rbinom(n, 1, p)`: **베르누이 시행**을 통해 100개의 0 또는 1 값을 생성합니다. 1이 나올 확률은 `p=0.4`입니다. `u` 벡터는 각 데이터가 1번 군집(`u=1`)에서 올지, 2번 군집(`u=0`)에서 올지를 결정하는 **"스위치"** 역할을 합니다.
*   `x1`, `x2`: 각각 **평균 10, 표준편차 1**의 정규분포와 **평균 17, 표준편차 1.5**의 정규분포에서 100개씩 데이터를 생성합니다.
*   `x = u * x1 + (1 - u) * x2`: `u` 벡터를 이용해 두 데이터를 섞습니다.
    *   만약 `u`의 i번째 원소가 1이면, `x`의 i번째 값은 `1 * x1[i] + 0 * x2[i]`가 되어 `x1`의 값이 됩니다.
    *   만약 `u`의 i번째 원소가 0이면, `x`의 i번째 값은 `0 * x1[i] + 1 * x2[i]`가 되어 `x2`의 값이 됩니다.
*   `plot(density(x))`: 최종적으로 생성된 혼합 데이터 `x`의 **확률 밀도 추정(density estimation)** 그래프를 그립니다.

---

#### 2. 혼합모형 분석 (mclust): 기본 모형 (이분산 가정)

```R
> library(mclust)
> # 기본 모형 (군집 수 G = 2)
> M1 = Mclust(x, G = 2)
> M1
> M1$parameters         # 추정된 모수
```

##### **함수 및 파라미터 기능 설명**

*   `library(mclust)`: 모형-기반 군집분석을 위한 `mclust` 패키지를 불러옵니다.
*   `Mclust(data, G, modelNames)`: 모형-기반 군집분석을 수행하는 핵심 함수입니다.
    *   `data`: 분석할 데이터 벡터 또는 행렬입니다. (여기서는 `x`)
    *   `G`: 군집의 개수(Number of components)를 지정합니다. (여기서는 `G=2`)
    *   `modelNames`: **매우 중요한 파라미터**로, 공분산 행렬의 구조를 지정합니다. 1차원 데이터의 경우, "E"와 "V" 두 가지 모델이 있습니다.
        *   **"E" (Equal variance)**: 모든 군집의 분산이 **동일하다(등분산)**고 가정합니다.
        *   **"V" (Variable variance)**: 각 군집의 분산이 **서로 다를 수 있다(이분산)**고 가정합니다.
        *   **이 파라미터를 지정하지 않으면, `mclust`는 "E"와 "V" 모델을 모두 적합시켜보고 BIC(Bayesian Information Criterion)가 더 좋은(낮은) 모델을 자동으로 선택합니다.**

*   **`M1 = Mclust(x, G = 2)`**는 "군집의 개수는 2개로 하고, 분산 구조는 'E'와 'V' 중 더 적합한 모델로 알아서 선택해줘"라는 의미입니다.

##### **결과(`M1` 출력) 상세 해석**
*   `'Mclust' model object: (V,2)`: `Mclust`가 여러 모델을 테스트해 본 결과, **분산이 서로 다른 모델("V")**이 군집 2개(`2`)일 때 가장 적합하다고 최종 선택했음을 알려줍니다. (우리가 데이터를 생성할 때 표준편차를 1과 1.5로 다르게 했으므로, 이는 매우 정확한 선택입니다.)
*   **`M1$parameters`**: 추정된 모수(parameter)들의 상세 정보입니다.
    *   `$pro`: 각 군집의 **혼합 비율(mixing proportion)**을 의미합니다.
        *   `[1] 0.428... 0.571...`: 1번 군집이 약 42.8%, 2번 군집이 약 57.2%의 비율로 섞여있다고 추정했습니다. 이는 우리가 설정한 실제 값(40%, 60%)과 매우 유사합니다.
    *   `$mean`: 각 군집의 **평균**을 의미합니다.
        *   `9.959... 17.052...`: 1번 군집의 평균은 약 9.96, 2번 군집의 평균은 약 17.05로 추정했습니다. 이는 실제 값(10, 17)과 거의 일치합니다.
    *   `$variance$sigmasq`: 각 군집의 **분산**을 의미합니다. (`sigmasq` = sigma squared)
        *   `[1] 0.886... 2.583...`: 1번 군집의 분산은 약 0.886(표준편차 ≈ 0.94), 2번 군집의 분산은 약 2.583(표준편차 ≈ 1.61)으로 추정했습니다. 이 또한 실제 값(분산 1, 2.25)과 매우 가깝습니다.

*   **`M1$z[, 1] > 0.5`**:
    *   `M1$z`: 각 데이터(100개)가 각 군집(2개)에 속할 **사후 확률(posterior probability)**을 담고 있는 100x2 행렬입니다.
    *   `M1$z[, 1]`: 각 데이터가 1번 군집에 속할 확률 벡터입니다.
    *   `> 0.5`: 1번 군집에 속할 확률이 50%가 넘는지를 `TRUE`/`FALSE`로 나타냅니다. 즉, 각 데이터가 최종적으로 어느 군집에 할당되는지를 보여주는 것과 같습니다.

---

#### 3. 혼합모형 분석 (mclust): 등분산 가정 모형

```R
> # 등분산 가정 모형 (모델 이름 "E")
> M2 = Mclust(x, G = 2, modelNames = "E")
> M2$parameters         # 추정된 모수
> M2$z[, 2] > 0.5       # 각 관측치가 2번 군집에 속할 확률 > 0.5
```

##### **함수 및 파라미터 기능 설명**
*   **`M2 = Mclust(x, G = 2, modelNames = "E")`**: 이번에는 `modelNames = "E"` 파라미터를 명시적으로 지정했습니다.
    *   **의미**: "군집의 개수는 2개로 하고, 두 군집의 분산은 **반드시 동일하다('E'qual)고 가정**하고 분석해줘"라는 의미입니다. 이는 실제 데이터 생성 과정과는 다른, **잘못된 가정**을 강제로 부여한 것입니다.

##### **결과(`M2$parameters`) 상세 해석**
*   `$pro`, `$mean`: 혼합 비율과 평균은 이분산 모델(`M1`)과 유사하게 추정되었습니다.
*   `$variance$sigmasq`:
    *   `[1] 1.833684`: **값이 하나뿐입니다.** 이는 `modelNames="E"` 제약 조건에 따라 두 군집의 분산이 동일하다고 가정했기 때문입니다. `mclust`는 두 군집의 분산을 모두 약 1.83으로 추정했습니다.
    *   **해석**: 이 값은 실제 분산 값인 1과 2.25의 중간 어딘가에 위치한 값입니다. 잘못된 가정(등분산)을 했기 때문에, 어느 한쪽에도 정확히 맞지 않는 어중간한 값으로 분산을 추정하게 된 것입니다.
*   **`M2$z[, 2] > 0.5`**: 등분산 가정 하에서 각 데이터가 2번 군집에 속하는지를 보여줍니다. 이 결과는 이분산을 가정한 `M1`의 군집 할당 결과와 약간의 차이를 보일 수 있습니다.

### 종합 결론

1.  **모형-기반 군집분석의 강력함**: `mclust`는 데이터가 여러 확률 분포의 혼합으로 이루어졌다고 가정하고, 데이터에 숨겨진 **각 분포의 모수(평균, 분산, 비율)를 매우 정확하게 추정**해냈습니다.
2.  **`modelNames` 파라미터의 중요성**: `mclust`는 공분산(1차원에서는 분산) 구조에 대한 다양한 가정을 할 수 있습니다. `modelNames`를 지정하지 않으면 **BIC 기준**을 통해 데이터에 가장 적합한 분산 구조를 자동으로 찾아주므로 매우 편리하고 강력합니다.
3.  **가정의 중요성**: `modelNames = "E"`를 통해 의도적으로 잘못된 가정(등분산)을 부여했을 때, 모델이 실제와 다른 어중간한 모수를 추정하는 것을 확인했습니다. 이는 **분석 모델의 가정이 실제 데이터의 특성과 부합하는 것이 얼마나 중요한지**를 보여주는 좋은 예시입니다.
